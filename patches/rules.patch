:100755 100755 87e0e16 63648ef M	debian/rules

diff --git a/debian/rules b/debian/rules
index 87e0e16..63648ef 100755
--- a/debian/rules
+++ b/debian/rules
@@ -23,3 +23,4 @@ kcapi_tools = \
  --enable-kcapi-encapp \
- --enable-kcapi-dgstapp
+ --enable-kcapi-dgstapp \
+ --enable-kcapi-hasher
 
@@ -52,2 +53,13 @@ override_dh_install-arch:
 
+execute_after_dh_strip:
+	# generate the hmac of the striped lib
+	./bin/kcapi-hasher -n sha512hmac ./debian/libkcapi1/usr/lib/$(shell uname -m)-linux-gnu/libkcapi.so.1.5.0 > ./debian/libkcapi1-hmac/usr/lib/$(shell uname -m)-linux-gnu/.libkcapi.so.1.5.0.hmac
+	sed -i 's/.\/debian\/libkcapi1//' ./debian/libkcapi1-hmac/usr/lib/$(shell uname -m)-linux-gnu/.libkcapi.so.1.5.0.hmac
+	./bin/kcapi-hasher -n sha512hmac ./debian/libkcapi1/usr/lib/$(shell uname -m)-linux-gnu/libkcapi.so.1 > ./debian/libkcapi1-hmac/usr/lib/$(shell uname -m)-linux-gnu/.libkcapi.so.1.hmac
+	sed -i 's/.\/debian\/libkcapi1//' ./debian/libkcapi1-hmac/usr/lib/$(shell uname -m)-linux-gnu/.libkcapi.so.1.hmac
+	./bin/kcapi-hasher -n sha512hmac ./debian/kcapi-tools/usr/bin/kcapi-hasher > ./debian/kcapi-tools/usr/bin/.kcapi-hasher.hmac
+	sed -u 's/.\/debian\/kcapi-tools\/usr\/bin\//*/' ./debian/kcapi-tools/usr/bin/.kcapi-hasher.hmac
+
+
+
 override_dh_auto_test-arch:
